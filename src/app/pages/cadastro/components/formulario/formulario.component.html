<form
  class="mx-auto max-w-[800px] p-5"
  [formGroup]="formCadastro"
  (ngSubmit)="submit()"
>
  <h2 class="mb-5 cursor-default text-2xl text-[#1890ff]">Dados Pessoais</h2>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group [nzPrefix]="userIcon" class="rounded-md p-2 text-base">
      <input
        formControlName="nome"
        type="text"
        nz-input
        placeholder="Nome Completo"
        class="truncate"
      />
    </nz-input-group>

    <ng-template #userIcon>
      <nz-icon nzType="user" nzTheme="outline" class="mr-2" />
    </ng-template>

    @if (
      formCadastro.get("nome")?.invalid && formCadastro.get("nome")?.touched
    ) {
      <span
        *ngIf="formCadastro.get('nome')?.errors?.['required']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O nome é obrigatório!
      </span>

      <span
        *ngIf="formCadastro.get('nome')?.errors?.['minlength']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O nome deve ter pelo menos 3 caracteres!
      </span>
    }
  </div>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group [nzPrefix]="mailIcon" class="rounded-md p-2 text-base">
      <input
        formControlName="email"
        type="email"
        nz-input
        placeholder="E-mail"
        class="truncate"
      />
    </nz-input-group>

    <ng-template #mailIcon>
      <nz-icon nzType="mail" nzTheme="outline" class="mr-2" />
    </ng-template>

    @if (
      formCadastro.get("email")?.invalid && formCadastro.get("email")?.touched
    ) {
      <span
        *ngIf="formCadastro.get('email')?.errors?.['required']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O e-mail é obrigatório!
      </span>

      <span
        *ngIf="formCadastro.get('email')?.errors?.['email']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O e-mail não tem um formato válido!
      </span>

      <span
        *ngIf="formCadastro.get('email')?.errors?.['emailJaExiste']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O e-mail informado já foi cadastrado!
      </span>
    }
  </div>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group [nzPrefix]="cpfIcon" class="rounded-md p-2 text-base">
      <input
        formControlName="cpf"
        type="text"
        nz-input
        placeholder="CPF"
        mask="000.000.000-00"
      />
    </nz-input-group>

    <ng-template #cpfIcon>
      <nz-icon nzType="idcard" nzTheme="outline" class="mr-2" />
    </ng-template>

    @if (formCadastro.get("cpf")?.invalid && formCadastro.get("cpf")?.touched) {
      <span
        *ngIf="formCadastro.get('cpf')?.errors?.['required']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O CPF é obrigatório!
      </span>

      <span
        *ngIf="
          formCadastro.get('cpf')?.errors?.['minlength'] ||
          formCadastro.get('cpf')?.errors?.['maxlength']
        "
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O CPF deve conter 11 dígitos!
      </span>

      <span
        *ngIf="formCadastro.get('cpf')?.errors?.['cpfJaExiste']"
        class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]"
      >
        O CPF informado já foi cadastrado!
      </span>
    }
  </div>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group [nzPrefix]="dateIcon" class="rounded-md p-2 text-base">
      <input
        formControlName="dataNascimento"
        type="text"
        nz-input
        placeholder="Data de Nascimento"
        mask="00/00/0000"
      />
    </nz-input-group>

    <ng-template #dateIcon>
      <nz-icon nzType="calendar" nzTheme="outline" class="mr-2" />
    </ng-template>

    @if (
      formCadastro.get("dataNascimento")?.invalid &&
      formCadastro.get("dataNascimento")?.touched
    ) {
      <!-- 1: Campo obrigatório -->
      @if (formCadastro.get("dataNascimento")?.errors?.["required"]) {
        <span class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]">
          A data de nascimento é obrigatória!
        </span>
      }
      <!-- 2: Tamanho -->
      @else if (
        formCadastro.get("dataNascimento")?.errors?.["minlength"] ||
        formCadastro.get("dataNascimento")?.errors?.["maxlength"]
      ) {
        <span class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]">
          A data de nascimento deve conter 8 dígitos!
        </span>
      }
      <!-- 3: Data inválida -->
      @else if (
        formCadastro.get("dataNascimento")?.errors?.["dataNascimentoInvalida"]
      ) {
        <span class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]">
          A data de nascimento informada não é válida!
        </span>
      }
    }
  </div>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group
      [nzPrefix]="locationIcon"
      class="rounded-md p-[5px] text-base"
    >
      <nz-select
        formControlName="estado"
        nzSize="large"
        class="w-full truncate"
        nzPlaceHolder="UF"
        (ngModelChange)="$event ? listarMunicipios($event) : null"
      >
        @for (estado of estados; track estado.sigla) {
          <nz-option
            nzValue="{{ estado.sigla }}"
            nzLabel="{{ estado.sigla }} - {{ estado.nome }}"
          />
        } @empty {
          <nz-option nzValue="vazio" nzLabel="Não foi possível listar" />
        }
      </nz-select>

      <ng-template #locationIcon>
        <nz-icon nzType="environment" nzTheme="outline" class="mr-2" />
      </ng-template>
    </nz-input-group>

    @if (
      formCadastro.get("estado")?.invalid && formCadastro.get("estado")?.touched
    ) {
      <span class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]">
        A UF é obrigatória!
      </span>
    }
  </div>

  <div class="relative mb-8 w-full sm:w-[50%]">
    <nz-input-group [nzPrefix]="cityIcon" class="rounded-md p-[5px] text-base">
      <nz-select
        formControlName="municipio"
        nzSize="large"
        class="w-full truncate"
        nzPlaceHolder="Município"
        [nzDisabled]="!formCadastro.get('estado')?.value"
      >
        @for (municipio of municipios; track municipio.codigo_ibge) {
          <nz-option
            nzValue="{{ municipio.nome }}"
            nzLabel="{{ municipio.nome }}"
          />
        } @empty {
          <nz-option nzValue="vazio" nzLabel="Não foi possível listar" />
        }
      </nz-select>

      <ng-template #cityIcon>
        <nz-icon nzType="verified" nzTheme="outline" class="mr-2" />
      </ng-template>
    </nz-input-group>

    @if (
      formCadastro.get("municipio")?.invalid &&
      formCadastro.get("municipio")?.touched
    ) {
      <span class="absolute left-0 top-full mt-[2px] text-[#ff4d4f]">
        O município é obrigatório!
      </span>
    }
  </div>

  <div class="mt-10 flex justify-center gap-6 sm:justify-start">
    @if (atualizandoCliente) {
      <button
        type="submit"
        nz-button
        nzType="primary"
        nzSize="default"
        class="grid place-content-center px-6 py-4 text-base"
      >
        Atualizar
      </button>
    } @else {
      <button
        type="submit"
        nz-button
        nzType="primary"
        nzSize="default"
        class="grid place-content-center px-6 py-4 text-base"
      >
        Salvar
      </button>
    }
    <button
      (click)="limparFormulario()"
      type="button"
      nz-button
      nzType="primary"
      nzSize="default"
      nzDanger
      class="grid place-content-center px-6 py-4 text-base"
    >
      Limpar
    </button>
  </div>
</form>
